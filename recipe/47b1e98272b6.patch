From 47b1e98272b677ef4ee70a0c5cf9a4578d04277a Mon Sep 17 00:00:00 2001
From: Erik Bray <erik.m.bray@gmail.com>
Date: Thu, 9 Feb 2017 17:15:06 +0000
Subject: [PATCH] In `flisten` check that the stream is not in an error state, as well as not eof

(The latter doesn't necessarily imply the former)
---
 src/c/file.d | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/ecl-16.1.2/src/c/file.d
+++ b/ecl-16.1.2/src/c/file.d
@@ -5317,7 +5317,7 @@
 flisten(cl_object stream, FILE *fp)
 {
         int aux;
-        if (feof(fp))
+  if (feof(fp) || ferror(fp))
                 return ECL_LISTEN_EOF;
 #ifdef FILE_CNT
         if (FILE_CNT(fp) > 0)
