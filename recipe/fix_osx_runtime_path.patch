From 6be9cb9dee2fc8df59604aa28413625898e70945 Mon Sep 17 00:00:00 2001
From: Fabrizio Fabbri <ffabbri4@bloomberg.net>
Date: Thu, 19 Jan 2017 23:12:43 +0100
Subject: [PATCH] osx: fix #343 runtime path

---
 src/aclocal.m4 | 4 ++--
 src/configure  | 4 ++--
 2 files changed, 4 insertions(+), 4 deletions(-)

--- a/ecl-16.1.2/src/aclocal.m4
+++ b/ecl-16.1.2/src/aclocal.m4
@@ -402,7 +402,7 @@
                 PICFLAG='-fPIC -fno-common'
                 SHARED_LDFLAGS="-dynamiclib -flat_namespace -undefined suppress ${LDFLAGS}"
                 BUNDLE_LDFLAGS="-bundle ${LDFLAGS}"
-                ECL_LDRPATH=''
+                ECL_LDRPATH='-Wl,-rpath,~A'
                 THREAD_CFLAGS='-D_THREAD_SAFE'
                 THREAD_LIBS='-lpthread'
                 # The GMP library has not yet been ported to Intel-OSX
@@ -429,7 +429,7 @@
                   ECL_GC_DIR=bdwgc
                 fi
                 SONAME="${SHAREDPREFIX}ecl.SOVERSION.${SHAREDEXT}"
-                SONAME_LDFLAGS="-Wl,-install_name,@libdir\@/SONAME -Wl,-compatibility_version,${PACKAGE_VERSION}"
+                SONAME_LDFLAGS="-Wl,-install_name,@rpath/SONAME -Wl,-compatibility_version,${PACKAGE_VERSION}"
                 ;;
         nsk*)
                 # HP Non-Stop platform
--- a/ecl-16.1.2/src/configure
+++ b/ecl-16.1.2/src/configure
@@ -5024,7 +5024,7 @@
                 PICFLAG='-fPIC -fno-common'
                 SHARED_LDFLAGS="-dynamiclib -flat_namespace -undefined suppress ${LDFLAGS}"
                 BUNDLE_LDFLAGS="-bundle ${LDFLAGS}"
-                ECL_LDRPATH=''
+                ECL_LDRPATH='-Wl,-rpath,~A'
                 THREAD_CFLAGS='-D_THREAD_SAFE'
                 THREAD_LIBS='-lpthread'
                 # The GMP library has not yet been ported to Intel-OSX
@@ -5051,7 +5051,7 @@
                   ECL_GC_DIR=bdwgc
                 fi
                 SONAME="${SHAREDPREFIX}ecl.SOVERSION.${SHAREDEXT}"
-                SONAME_LDFLAGS="-Wl,-install_name,@libdir\@/SONAME -Wl,-compatibility_version,${PACKAGE_VERSION}"
+                SONAME_LDFLAGS="-Wl,-install_name,@rpath/SONAME -Wl,-compatibility_version,${PACKAGE_VERSION}"
                 ;;
         nsk*)
                 # HP Non-Stop platform
